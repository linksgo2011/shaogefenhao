(window.webpackJsonp=window.webpackJsonp||[]).push([[123],{917:function(s,n,a){"use strict";a.r(n);var t=a(15),e=Object(t.a)({},(function(){var s=this,n=s.$createElement,a=s._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"使用-nginx-缓存限制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用-nginx-缓存限制"}},[s._v("#")]),s._v(" 使用 nginx 缓存限制")]),s._v(" "),a("p",[s._v("expires起到控制页面缓存的作用，合理的配置expires可以减少很多服务器的请求\n要配置expires，可以在http段中或者server段中或者location段中加入\nPS. 可以限制单个接口的访问")]),s._v(" "),a("p",[s._v("只需要增加一个反向代理，然后设置 1 秒过期即可，1 s内拿到的是同样的内容。可以将图片等静态资源文件设置时间较长，接口 API 时间设置较短即可。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("location ~ ^/user/ {\n\n  \tproxy_pass http://user.example.com;\n\n    \texpires 1;   //1h //1d //expires max; 部分文件看需要可以永久\n }\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("h2",{attrs:{id:"利用-ngnix-的ip限制访问次数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#利用-ngnix-的ip限制访问次数"}},[s._v("#")]),s._v(" 利用 Ngnix 的IP限制访问次数")]),s._v(" "),a("p",[s._v("nginx可以通过HttpLimitReqModul和HttpLimitZoneModule配置来限制ip在同一时间段的访问次数。")]),s._v(" "),a("p",[s._v("HttpLimitReqModul用来限制连单位时间内连接数的模块，使用limit_req_zone和limit_req指令配合使用来达到限制。一旦并发连接超过指定数量，就会返回503错误。")]),s._v(" "),a("p",[s._v("HttpLimitConnModul用来限制单个ip的并发连接数，使用limit_zone和limit_conn指令。")]),s._v(" "),a("p",[s._v("这两个模块的区别前一个是对一段时间内的连接数限制，后者是对同一时刻的连接数限制。")]),s._v(" "),a("p",[s._v("配置实例")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("http{\n    ...\n    #定义一个名为allips的limit_req_zone用来存储session，大小是10M内存，\n    #以$binary_remote_addr 为key,限制平均每秒的请求为20个，\n    #1M能存储16000个状态，rete的值必须为整数，\n    #如果限制两秒钟一个请求，可以设置成30r/m\n     \n    limit_req_zone $binary_remote_addr zone=allips:10m rate=20r/s;\n    ...\n    server{\n        ...\n        location {\n            ...\n            #限制每ip每秒不超过20个请求，漏桶数burst为5\n            #brust的意思就是，如果第1秒、2,3,4秒请求为19个，\n            #第5秒的请求为25个是被允许的。\n            #但是如果你第1秒就25个请求，第2秒超过20的请求返回503错误。\n            #nodelay，如果不设置该选项，严格使用平均速率限制请求数，\n            #第1秒25个请求时，5个请求放到第2秒执行，\n            #设置nodelay，25个请求将在第1秒执行。\n             \n            limit_req zone=allips burst=5 nodelay;\n            ...\n        }\n        ...\n    }\n    ...\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br")])]),a("h2",{attrs:{id:"使用-redis-在应用层面限制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用-redis-在应用层面限制"}},[s._v("#")]),s._v(" 使用 Redis 在应用层面限制")]),s._v(" "),a("p",[s._v("使用拦截器对请求根据 IP 计数，写入 redis。这种方案没有 Ngnix 高效。\n可以参考 el-admin 中的实现。")]),s._v(" "),a("h2",{attrs:{id:"参考资料"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考资料"}},[s._v("#")]),s._v(" 参考资料")]),s._v(" "),a("ul",[a("li",[s._v("https://www.cnblogs.com/wangdaijun/p/6264288.html")]),s._v(" "),a("li",[s._v("https://www.cnblogs.com/saneri/p/5315535.html")])])])}),[],!1,null,null,null);n.default=e.exports}}]);