(window.webpackJsonp=window.webpackJsonp||[]).push([[295],{1111:function(e,a,s){"use strict";s.r(a);var t=s(15),n=Object(t.a)({},(function(){var e=this,a=e.$createElement,s=e._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h2",{attrs:{id:"一、下载geoip数据库"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#一、下载geoip数据库"}},[e._v("#")]),e._v(" 一、下载GeoIP数据库")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("wget http://geolite.maxmind.com/download/geoip/api/c/GeoIP.tar.gz\nwget http://geolite.maxmind.com/download/geoip/database/GeoLiteCity.dat.gz\nwget http://geolite.maxmind.com/download/geoip/database/GeoLiteCountry/GeoIP.dat.gz\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br")])]),s("h2",{attrs:{id:"二、安装geoip"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#二、安装geoip"}},[e._v("#")]),e._v(" 二、安装GeoIP")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("tar -xzvf GeoIP.tar.gz\ncd GeoIP\n./configure\nmake && make install\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br")])]),s("h2",{attrs:{id:"三、解压geolitecity-dat-gz和geoip-dat-gz"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#三、解压geolitecity-dat-gz和geoip-dat-gz"}},[e._v("#")]),e._v(" 三、解压GeoLiteCity.dat.gz和GeoIP.dat.gz")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("gunzip GeoIP.dat.gz\ngunzip GeoLiteCity.dat.gz \n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br")])]),s("h2",{attrs:{id:"四、将上面两个文件夹移动到自定义目录-我这儿是-etc-nginx-geoip"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#四、将上面两个文件夹移动到自定义目录-我这儿是-etc-nginx-geoip"}},[e._v("#")]),e._v(" 四、将上面两个文件夹移动到自定义目录，我这儿是/etc/nginx/geoip")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("mv GeoIP.dat /opt/nginx/geoip/\nmv GeoLiteCity.dat /opt/nginx/geoip/\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br")])]),s("h2",{attrs:{id:"五、修改nginx的配置文件nginx-conf"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#五、修改nginx的配置文件nginx-conf"}},[e._v("#")]),e._v(" 五、修改nginx的配置文件nginx.conf")]),e._v(" "),s("h3",{attrs:{id:"_5-1在http模块加入geoip库的路径-注意要换成你自己的路径"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-1在http模块加入geoip库的路径-注意要换成你自己的路径"}},[e._v("#")]),e._v(" 5.1在http模块加入GeoIP库的路径（注意要换成你自己的路径）")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("geoip_country  /etc/nginx/geoip/GeoIP.dat;\ngeoip_city     /etc/nginx/geoip/GeoLiteCity.dat;\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br")])]),s("h3",{attrs:{id:"_5-2在server模块拦截指定国家ip-这里以中国cn为例-其他国家的代码可以自己问问度娘或者谷歌"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-2在server模块拦截指定国家ip-这里以中国cn为例-其他国家的代码可以自己问问度娘或者谷歌"}},[e._v("#")]),e._v(" 5.2在server模块拦截指定国家IP（这里以中国CN为例，其他国家的代码可以自己问问度娘或者谷歌）")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("if ($geoip_country_code = CN) {\n    return 403;\n}\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br")])]),s("p",[e._v("这里返回403在页面上来看就是nginx的403默认页面")]),e._v(" "),s("p",[e._v("如果要跳转到自定义页面，第一步再定义一个server模块用于访问自定义页面")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("server {\n    listen 81;    #可以自定义端口（注意不要被占用了）\n    server_name your_server_name;     #这里填写你的ip或域名\n    root /usr/local/nginx/html/;      # 存放自定义页面的根目录\n    index index.html;     #自定义页面\n}\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br")])]),s("p",[e._v("第二步将“return 403”修改为重定向")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("if ($geoip_country_code = CN) {\n    rewrite ^/(.*) http://your_server_name:81/ break;\n}\nyour_server_name就是第一步中定义的server模块中的ip或域名，端口也要加上\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br")])]),s("p",[e._v("ps：我看网上说可以自定义403页面然后直接“return 403”就可以跳转到自定义页面了，")]),e._v(" "),s("p",[e._v("我试过好像不行，在if语句里面无法直接return到自定义页面，")]),e._v(" "),s("p",[e._v("但是在if块外面是可以自定义403页面的。")]),e._v(" "),s("p",[e._v("有没有大神有更简单的方法跳转到自定义页面，欢迎评论O(∩_∩)O哈哈~")])])}),[],!1,null,null,null);a.default=n.exports}}]);