(window.webpackJsonp=window.webpackJsonp||[]).push([[371],{1200:function(s,a,e){"use strict";e.r(a);var t=e(15),r=Object(t.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h2",{attrs:{id:"使用场景"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#使用场景"}},[s._v("#")]),s._v(" 使用场景")]),s._v(" "),e("p",[s._v("当多个程序需要对同一个条数据访问，并发生争抢的情况，需要保证隔离性。例如在批量任务处理的场景下，job 1读取并更新一条数据时，job 2不应该修改这条数据。")]),s._v(" "),e("p",[s._v("原理为使用SQL的 select ... for update 语句。当事务被提交后，锁应该被释放。")]),s._v(" "),e("h2",{attrs:{id:"使用jpa-实现"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#使用jpa-实现"}},[s._v("#")]),s._v(" 使用JPA 实现")]),s._v(" "),e("p",[s._v("JPA 中 Repository 中有如下定义：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('\n@Lock(value = LockModeType.PESSIMISTIC_WRITE)\n@Query(value = "select t from Course t where t.id =?1 ")\nCourse queryAllById( Integer courseId);\n\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("p",[s._v("在业务代码中，应加上下面语句,当事务处理完后，for update才会将行级锁解除")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("@Transactional(isolation = Isolation.READ_COMMITTED)\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h2",{attrs:{id:"参考资料"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#参考资料"}},[s._v("#")]),s._v(" 参考资料")]),s._v(" "),e("ul",[e("li",[s._v("https://blog.csdn.net/zc_ad/article/details/83578487")])])])}),[],!1,null,null,null);a.default=r.exports}}]);