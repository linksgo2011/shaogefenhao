(window.webpackJsonp=window.webpackJsonp||[]).push([[372],{1201:function(e,a,s){"use strict";s.r(a);var t=s(15),n=Object(t.a)({},(function(){var e=this,a=e.$createElement,s=e._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h2",{attrs:{id:"批量增加"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#批量增加"}},[e._v("#")]),e._v(" 批量增加")]),e._v(" "),s("p",[e._v("可以自定义一个 Repository 的实现，然后使用 entitymanager 的 persist 语句完成。")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("\n@Override\n    @Transactional\n    public <S extends T> Iterable<S> batchSave(Iterable<S> var1) {\n        Iterator<S> iterator = var1.iterator();\n        int index = 0;\n        while (iterator.hasNext()){\n            em.persist(iterator.next());\n            index++;\n            if (index % BATCH_SIZE == 0){\n                em.flush();\n                em.clear();\n            }\n        }\n        if (index % BATCH_SIZE != 0){\n            em.flush();\n            em.clear();\n        }\n        return var1;\n    }\n\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br"),s("span",{staticClass:"line-number"},[e._v("12")]),s("br"),s("span",{staticClass:"line-number"},[e._v("13")]),s("br"),s("span",{staticClass:"line-number"},[e._v("14")]),s("br"),s("span",{staticClass:"line-number"},[e._v("15")]),s("br"),s("span",{staticClass:"line-number"},[e._v("16")]),s("br"),s("span",{staticClass:"line-number"},[e._v("17")]),s("br"),s("span",{staticClass:"line-number"},[e._v("18")]),s("br"),s("span",{staticClass:"line-number"},[e._v("19")]),s("br"),s("span",{staticClass:"line-number"},[e._v("20")]),s("br"),s("span",{staticClass:"line-number"},[e._v("21")]),s("br")])]),s("p",[e._v("在application.properties,设置spring.jpa.properties.hibernate.jdbc.batch_size\n在application.properties,设置spring.jpa.properties.hibernate.generate_statistics（只是为了检查批处理是否正常）\n在application.properties设置JDBC URL中rewriteBatchedStatements=true （特定于MySQL的优化）\n在application.properties设置 JDBC URL中使用cachePrepStmts=true（启用缓存，如果您决定设置prepStmtCacheSize，  则也很有用  prepStmtCacheSqlLimit;等等;如果没有此设置，则禁用缓存）\n在application.properties设置 JDBC URL中useServerPrepStmts=true（通过这种方式切换到服务器端预处理语句（可能会显着提升性能））\n在实体中，使用指定的生成器，  因为MySQL IDENTITY将导致批处理被禁用\n在DAO中，不时刷新并清除持久性上下文。这样，您就可以避免“压跨”持久化上下文。")]),e._v(" "),s("p",[e._v("不建议使用 JPQL 语句进行批量增加，会有一些奇怪的问题，实际工作中更多的使用原生 SQL 进行批量的增加。")]),e._v(" "),s("h2",{attrs:{id:"批量删除"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#批量删除"}},[e._v("#")]),e._v(" 批量删除")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('    @Modifying\n    @Query("delete from Feature")\n    void batchDeleteAll();\n')])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br")])]),s("p",[e._v("需要注意，在 @Query 做数据修改时，需要机上 @Modifying 注解")]),e._v(" "),s("h2",{attrs:{id:"批量更新"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#批量更新"}},[e._v("#")]),e._v(" 批量更新")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('    @Modifying\n    @Query("update Feature feature set feature.name = ?1")\n    void batchUpdateName(String newName);\n')])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br")])])])}),[],!1,null,null,null);a.default=n.exports}}]);