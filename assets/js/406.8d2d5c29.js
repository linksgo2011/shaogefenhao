(window.webpackJsonp=window.webpackJsonp||[]).push([[406],{1241:function(s,n,a){"use strict";a.r(n);var t=a(15),e=Object(t.a)({},(function(){var s=this,n=s.$createElement,a=s._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[s._v("#")]),s._v(" 简介")]),s._v(" "),a("p",[s._v("k6 是一个压力测试套件，使用 golang 编写。主要特性有：")]),s._v(" "),a("ul",[a("li",[s._v("提供了友好的 CLI  工具")]),s._v(" "),a("li",[s._v("使用 JavaScript 代码编写测试用例")]),s._v(" "),a("li",[s._v("可以根据性能条件设置阈值，表明成功还是失败")])]),s._v(" "),a("p",[s._v("k6 没有使用 nodejs 而是 golang 程序，通过包裹了一个 JavaScript 运行时来运行 JavaScript 脚本，因此不能直接使用 npm 包以及 Nodejs 提供的一些 API。")]),s._v(" "),a("p",[s._v("同时，k6 在运行测试时，没有启动浏览器，主要用于测试页面以及 API 加载速度。k6 提供了通过网络请求（HAR）生成测试脚本的方法，实现更简便的测试脚本编写，以及 session 的维护。")]),s._v(" "),a("h2",{attrs:{id:"安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[s._v("#")]),s._v(" 安装")]),s._v(" "),a("p",[s._v("在 Mac 上比较简单，直接使用 HomeBrew 即可安装：")]),s._v(" "),a("blockquote",[a("p",[s._v("brew install k6")])]),s._v(" "),a("p",[s._v("其他平台官网也提供了相应的安装方式，比较特别的是提供了 Docker 的方式运行。")]),s._v(" "),a("h2",{attrs:{id:"使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用"}},[s._v("#")]),s._v(" 使用")]),s._v(" "),a("p",[s._v("直接使用 k6 的命令运行测试，官网提供了一个例子：")]),s._v(" "),a("blockquote",[a("p",[s._v("k6 run github.com/loadimpact/k6/samples/http_get.js")])]),s._v(" "),a("p",[s._v("也可以编写自己的测试脚本:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('import http from "k6/http";\nimport { sleep } from "k6";\n\nexport default function() {\n  http.get("https://www.thoughtworks.com");\n  sleep(1);\n};\n\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("保存文件 script.js 后运行 k6 命令")]),s._v(" "),a("blockquote",[a("p",[s._v("k6 run script.js")])]),s._v(" "),a("p",[s._v("然后可以看到 http 请求的各项指标")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("        /\\      |‾‾|  /‾‾/  /‾/   \n     /\\  /  \\     |  |_/  /  / /    \n    /  \\/    \\    |      |  /  ‾‾\\  \n   /          \\   |  |‾\\  \\ | (_) | \n  / __________ \\  |__|  \\__\\ \\___/ .io\n\n  execution: local\n     output: -\n     script: k6.js\n\n    duration: -,  iterations: 1\n         vus: 1, max: 1\n\n    done [==========================================================] 1 / 1\n\n    data_received..............: 108 kB 27 kB/s\n    data_sent..................: 1.0 kB 252 B/s\n    http_req_blocked...........: avg=2.35s    min=2.35s    med=2.35s    max=2.35s    p(90)=2.35s    p(95)=2.35s   \n    http_req_connecting........: avg=79.18ms  min=79.18ms  med=79.18ms  max=79.18ms  p(90)=79.18ms  p(95)=79.18ms \n    http_req_duration..........: avg=639.03ms min=639.03ms med=639.03ms max=639.03ms p(90)=639.03ms p(95)=639.03ms\n    http_req_receiving.........: avg=358.12ms min=358.12ms med=358.12ms max=358.12ms p(90)=358.12ms p(95)=358.12ms\n    http_req_sending...........: avg=1.79ms   min=1.79ms   med=1.79ms   max=1.79ms   p(90)=1.79ms   p(95)=1.79ms  \n    http_req_tls_handshaking...: avg=701.46ms min=701.46ms med=701.46ms max=701.46ms p(90)=701.46ms p(95)=701.46ms\n    http_req_waiting...........: avg=279.12ms min=279.12ms med=279.12ms max=279.12ms p(90)=279.12ms p(95)=279.12ms\n    http_reqs..................: 1      0.249921/s\n    iteration_duration.........: avg=4s       min=4s       med=4s       max=4s       p(90)=4s       p(95)=4s      \n    iterations.................: 1      0.249921/s\n    vus........................: 1      min=1 max=1\n    vus_max....................: 1      min=1 max=1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br")])]),a("p",[s._v("运行压力测试时，需要增加更多的虚拟用户（VU），vus 参数和持续时间的参数:")]),s._v(" "),a("blockquote",[a("p",[s._v("k6 run --vus 10 --duration 30s script.js")])]),s._v(" "),a("h2",{attrs:{id:"编写测试脚本的一些规则"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#编写测试脚本的一些规则"}},[s._v("#")]),s._v(" 编写测试脚本的一些规则")]),s._v(" "),a("p",[a("code",[s._v("default")]),s._v(" 方法是用于给每个 VU 以及每次迭代重复运行的，因此需要把真正的测试代码放到这个方法中，例如访问某个页面。")]),s._v(" "),a("p",[s._v("为了保证测试的准确性，一些初始化的代码不应该放到 "),a("code",[s._v("default")]),s._v(" 方法中。尤其是文件的读取等依赖环境上下文的操作不能放到 "),a("code",[s._v("default")]),s._v(" 方法中执行，这样做也会丢失 k6 分布式运行的能力。")]),s._v(" "),a("p",[s._v("前面提到的命令行参数，例如指定虚拟用户数量 "),a("code",[s._v("--vus 10")]),s._v("，这些参数也可以放到脚本代码中。通过暴露一个 options 对象即可。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('export let options = {\n  vus: 10,\n  duration: "30s"\n};\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("为了更为真实的模拟用户访问的场景，k6 提供了在整个测试期间让用户数量和访问时间呈阶段性变化的能力。只需要在 options 中增加 stages 参数即可：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('export let options = {\n stages: [\n    { duration: "30s", target: 20 },\n    { duration: "1m30s", target: 10  },\n    { duration: "20s", target: 0 },\n  ]\n};\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("在测试过程中需要检查网络请求是否成功，返回的状态码是否正确，以及响应时间是否符合某个阈值。在脚本中可以通过调用 check() 方法编写检查语句，以便 k6 能收集到报告。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('import http from "k6/http";\nimport { check, sleep } from "k6";\n\nexport let options = {\n  vus: 10,\n  duration: "30s"\n};\n\nexport default function() {\n  let res = http.get("http://test.loadimpact.com");\n  check(res, {\n    "status was 200": (r) => r.status == 200,\n    "transaction time OK": (r) => r.timings.duration < 200\n  });\n  sleep(1);\n};\n\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("h2",{attrs:{id:"报告输出"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#报告输出"}},[s._v("#")]),s._v(" 报告输出")]),s._v(" "),a("p",[s._v("k6 默认将报告输出到 stdout 控制台，同时也提供了多种格式报告输出，包括：")]),s._v(" "),a("ul",[a("li",[s._v("JSON")]),s._v(" "),a("li",[s._v("CSV")]),s._v(" "),a("li",[s._v("InfluxDB")]),s._v(" "),a("li",[s._v("Apache Kafka")]),s._v(" "),a("li",[s._v("StatsD")]),s._v(" "),a("li",[s._v("Datadog")]),s._v(" "),a("li",[s._v("Load Impact cloud platform")])]),s._v(" "),a("p",[s._v("当然，我们在编写测试的时候不可能只有一个用例，对多个场景可以在脚本中通过 "),a("code",[s._v("group")]),s._v(" 进行分组，分组后输出的报告会按照分组排列。同时，也可以使用对一个组整体性能衡量的指标 "),a("code",[s._v("group_duration")]),s._v("。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('import { group } from "k6";\n\nexport default function() {\n  group("user flow: returning user", function() {\n    group("visit homepage", function() {\n      // load homepage resources\n    });\n    group("login", function() {\n      // perform login\n    });\n  });\n};\n\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("p",[s._v("InfluxDB 等外部数据收集平台时，还可以打上标签，供过滤和检索使用。k6 提供了一些内置的标签，并允许用户自定义标签。")]),s._v(" "),a("h2",{attrs:{id:"相关资料"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#相关资料"}},[s._v("#")]),s._v(" 相关资料")]),s._v(" "),a("ul",[a("li",[s._v("官方文档 https://docs.k6.io/docs")])])])}),[],!1,null,null,null);n.default=e.exports}}]);